<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">प्रोफेशनल बिज़नेस विश कार्ड जेनरेटर</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Cropper.js लाइब्रेरी जोड़ी गई -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Tiro+Devanagari+Hindi:ital@1&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #f0f8ff;
            --text-dark: #333;
            --text-light: #555;
            --bg-color: #eef2f7;
            --white: #ffffff;
            --border-color: #ddd;
            --input-bg: #ffffff;
        }

        body.dark-mode {
            --primary-color: #4cabff;
            --secondary-color: #2c3e50;
            --text-dark: #ecf0f1;
            --text-light: #bdc3c7;
            --bg-color: #1c2833;
            --white: #283747;
            --border-color: #444;
            --input-bg: #34495e;
        }

        body {
            font-family: 'Poppins', sans-serif;
            text-align: center;
            background-color: var(--bg-color);
            color: var(--text-dark);
            margin: 0;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 500px;
            width: 100%;
            background-color: var(--white);
            padding: 20px 30px 30px 30px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
        }
        
        .settings-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .lang-selector button {
            padding: 5px 10px;
            font-size: 0.9em;
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-light);
            cursor: pointer;
            border-radius: 6px;
            margin: 0 4px;
        }
        .lang-selector button.active {
            background-color: var(--primary-color);
            color: #fff;
            border-color: var(--primary-color);
            font-weight: bold;
        }
        
        .dark-mode-toggle { display: flex; align-items: center; gap: 8px; font-size: 0.9em; color: var(--text-light); }
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(20px); }


        h1, h2 { color: var(--primary-color); }
        h1 { font-size: 1.8em; margin-bottom: 20px; }
        h2 { font-size: 1.5em; margin-bottom: 15px; }

        .input-form { display: flex; flex-direction: column; gap: 15px; }
        .input-form input {
            width: 95%;
            padding: 12px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg);
            color: var(--text-dark);
            border-radius: 8px;
            font-size: 1em;
        }
        .input-form label {
            background-color: var(--secondary-color);
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px dashed var(--primary-color);
            color: var(--text-dark);
        }
        .input-form input[type="file"] { display: none; }

        button {
            padding: 12px 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        #quotes-selection-section { margin-top: 20px; }
        .quote-list {
            list-style: none;
            padding: 0;
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 8px;
        }
        .quote-item {
            padding: 12px;
            margin-bottom: 8px;
            background-color: var(--secondary-color);
            color: var(--text-dark);
            border-radius: 8px;
            cursor: pointer;
            border-left: 4px solid var(--primary-color);
            text-align: left;
        }
        .quote-item.selected {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
        }

        .business-card {
            margin-top: 25px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            position: relative;
            background-size: cover;
            background-position: center;
            overflow: hidden;
            color: #ffffff;
            height: 350px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
        }

        .business-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5); 
            z-index: 1;
        }
        
        .business-card.theme-morning::before { background: linear-gradient(135deg, rgba(246, 211, 101, 0.6), rgba(253, 160, 133, 0.6)); }
        .business-card.theme-afternoon::before { background: linear-gradient(135deg, rgba(161, 196, 253, 0.6), rgba(194, 233, 251, 0.6)); }
        .business-card.theme-evening::before { background: linear-gradient(135deg, rgba(255, 126, 95, 0.7), rgba(254, 180, 123, 0.7)); }
        .business-card.theme-night::before { background: linear-gradient(135deg, rgba(44, 62, 80, 0.8), rgba(75, 108, 183, 0.8)); }

        .card-body, .card-footer {
            position: relative;
            z-index: 2;
            text-shadow: 1px 1px 6px rgba(0,0,0,0.7);
        }

        .card-body {
            flex-grow: 1;
            display: flex;
            flex-direction: column; /* बदला हुआ: अभिवादन और कोटेशन को लंबवत रखने के लिए */
            align-items: center;
            justify-content: center;
            padding: 10px 0;
        }

        /* नया स्टाइल: अभिवादन के लिए */
        #greetingDisplay {
            font-family: 'Poppins', sans-serif;
            font-size: 1.9em;
            font-weight: 700;
            margin-bottom: 15px;
            color: #fff;
        }

        #quoteDisplay {
            font-family: 'Tiro Devanagari Hindi', serif;
            font-style: italic;
            font-size: 1.6em; /* थोड़ा छोटा किया गया */
            line-height: 1.5;
            max-width: 95%;
            text-align: center;
            margin-top: 0;
        }
         #quoteDisplay::before, #quoteDisplay::after { display: none; }

        .card-footer {
            display: flex;
            align-items: center;
            gap: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.4);
        }

        #userImagePreview {
            width: 75px;
            height: 75px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid rgba(255, 255, 255, 0.9);
            flex-shrink: 0;
        }
        
        .user-details { text-align: left; }
        #userNameDisplay { font-size: 1.5em; font-weight: 700; margin: 0; }
        #userContactDisplay, #userAddressDisplay { font-size: 0.9em; margin: 4px 0 0 0; opacity: 0.9; }
        .share-button { background-color: #25D366; font-size: 1.1em; margin-top: 20px; }
        .ad-container { margin: 15px auto; display: flex; justify-content: center; align-items: center; }

        /* क्रॉपर के लिए Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.7);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: var(--white);
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 450px;
            text-align: center;
        }
        .modal-content h2 { margin-top: 0; }
        #image-crop-container {
            width: 100%;
            height: 300px;
            margin-bottom: 15px;
        }
        #imageToCrop {
            max-width: 100%;
            display: block;
        }
    </style>
    <!-- विज्ञापन कोड 1 -->
    <script type='text/javascript' src='//pl27270386.profitableratecpm.com/75/25/24/752524902fd57d63f18f963c43e2d393.js'></script>
</head>
<body>

    <div class="container">
        
        <div class="settings-bar">
            <div class="lang-selector">
                <button id="lang-hi" class="active" onclick="setLanguage('hi')">हिंदी</button>
                <button id="lang-en" onclick="setLanguage('en')">English</button>
            </div>
            <div class="dark-mode-toggle">
                <span id="darkModeLabel">डार्क मोड</span>
                <label class="switch">
                    <input type="checkbox" id="darkModeToggle">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <!-- विज्ञापन कोड 2 (728x90) -->
        <div class="ad-container">
            <script type="text/javascript">
                atOptions = { 'key' : '1626f89d7ca645715c072a794b8c2cd1', 'format' : 'iframe', 'height' : 90, 'width' : 728, 'params' : {} };
            </script>
            <script type="text/javascript" src="//www.highperformanceformat.com/1626f89d7ca645715c072a794b8c2cd1/invoke.js"></script>
        </div>
        
        <!-- चरण 1: उपयोगकर्ता जानकारी फॉर्म -->
        <div id="input-section">
            <h1 id="mainHeading">अपना बिजनेस कार्ड बनाएं</h1>
            <div class="input-form">
                <input type="text" id="userName" placeholder="अपना पूरा नाम लिखें">
                <input type="tel" id="userContact" placeholder="अपना कांटेक्ट नंबर लिखें (वैकल्पिक)">
                <input type="text" id="userAddress" placeholder="अपना पता लिखें (वैकल्पिक)">
                <label for="userPhoto" id="photoLabel">🖼️ अपनी प्रोफाइल फोटो चुनें</label>
                <input type="file" id="userPhoto" accept="image/*">
                
                <!-- विज्ञापन कोड 3 (300x250) -->
                <div class="ad-container">
                    <script type="text/javascript">
                        atOptions = { 'key' : 'cd469ddc961f5fee536f03697078ff56', 'format' : 'iframe', 'height' : 250, 'width' : 300, 'params' : {} };
                    </script>
                    <script type="text/javascript" src="//www.highperformanceformat.com/cd469ddc961f5fee536f03697078ff56/invoke.js"></script>
                </div>

                <button id="showQuotesBtn" onclick="showQuotes()">कोटेशन देखें</button>
            </div>
        </div>

        <!-- चरण 2: कोटेशन चुनने का सेक्शन -->
        <div id="quotes-selection-section" style="display:none;">
            <h2 id="timeBasedHeading">एक कोटेशन चुनें:</h2>
            <div class="quote-list" id="quotesList"></div>
        </div>

        <!-- चरण 3 & 4: प्रीव्यू और शेयरिंग सेक्शन -->
        <div id="wishSection" style="display:none;">

            <!-- विज्ञापन कोड 4 (468x60) -->
            <div class="ad-container">
                <script type="text/javascript">
                    atOptions = { 'key' : '293c346ff3b50409d9211f545593daba', 'format' : 'iframe', 'height' : 60, 'width' : 468, 'params' : {} };
                </script>
                <script type="text/javascript" src="//www.highperformanceformat.com/293c346ff3b50409d9211f545593daba/invoke.js"></script>
            </div>

            <div class="business-card" id="captureArea">
                <div class="card-body">
                    <!-- नया एलिमेंट: अभिवादन प्रदर्शित करने के लिए -->
                    <h2 id="greetingDisplay"></h2>
                    <p id="quoteDisplay"></p>
                </div>
                <div class="card-footer">
                    <img id="userImagePreview" src="" alt="User Photo">
                    <div class="user-details">
                        <h3 id="userNameDisplay"></h3>
                        <p id="userContactDisplay"></p>
                        <p id="userAddressDisplay"></p>
                    </div>
                </div>
            </div>
            <button class="share-button" id="shareBtn" onclick="shareWish(event)">📤 शेयर करें</button>
            
            <!-- विज्ञापन कोड 5 (320x50) -->
            <div class="ad-container">
                <script type="text/javascript">
                    atOptions = { 'key' : 'd60e5d2052ec60f1ebfd8f0161fc61d6', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} };
                </script>
                <script type="text/javascript" src="//www.highperformanceformat.com/d60e5d2052ec60f1ebfd8f0161fc61d6/invoke.js"></script>
            </div>
        </div>
    </div>

    <!-- फोटो क्रॉप करने के लिए Modal HTML -->
    <div id="cropModal" class="modal">
        <div class="modal-content">
            <h2 id="cropModalTitle">अपनी फोटो सेट करें</h2>
            <div id="image-crop-container">
                <img id="imageToCrop" src="">
            </div>
            <button id="cropConfirmBtn">फोटो सेट करें</button>
        </div>
    </div>

    <script>
        // --- LANGUAGE & UI TEXT ---
        let currentLanguage = 'hi';
        const uiText = {
            hi: {
                pageTitle: "प्रोफेशनल बिज़नेस विश कार्ड जेनरेटर",
                darkModeLabel: "डार्क मोड",
                mainHeading: "अपना बिजनेस कार्ड बनाएं",
                namePlaceholder: "अपना पूरा नाम लिखें",
                contactPlaceholder: "अपना कांटेक्ट नंबर लिखें (वैकल्पिक)",
                addressPlaceholder: "अपना पता लिखें (वैकल्पिक)",
                photoLabelDefault: "🖼️ अपनी प्रोफाइल फोटो चुनें",
                photoLabelSelected: "✅ फोटो सफलतापूर्वक सेट हो गई!",
                showQuotesBtn: "कोटेशन देखें",
                morningHeading: "🌞 सुप्रभात कोटेशन चुनें:",
                afternoonHeading: "☀️ शुभ दोपहर कोटेशन चुनें:",
                eveningHeading: "🌆 शुभ संध्या कोटेशन चुनें:",
                nightHeading: "🌙 शुभ रात्रि कोटेशन चुनें:",
                greetingMorning: "सुप्रभात",
                greetingAfternoon: "शुभ दोपहर",
                greetingEvening: "शुभ संध्या",
                greetingNight: "शुभ रात्रि",
                shareBtn: "📤 शेयर करें",
                shareProcessing: "प्रोसेसिंग...",
                shareMessage: " की ओर से एक प्यारा संदेश! ✨",
                createYourOwnMessage: "\n\nआप भी ऐसे ही अपना बिजनेस कार्ड बना सकते हैं और अपने मित्रों को भेज सकते हैं। यहाँ बनाएँ:",
                alertMessage: "कृपया अपना नाम और प्रोफाइल फोटो ज़रूर चुनें!",
                shareError: "शेयरिंग में त्रुटि हुई। कृपया इमेज डाउनलोड करें और मैन्युअल रूप से शेयर करें।",
                cropModalTitle: "अपनी फोटो सेट करें",
                cropConfirmBtn: "फोटो सेट करें"
            },
            en: {
                pageTitle: "Professional Business Wish Card Generator",
                darkModeLabel: "Dark Mode",
                mainHeading: "Create Your Business Card",
                namePlaceholder: "Enter your full name",
                contactPlaceholder: "Enter your contact number (optional)",
                addressPlaceholder: "Enter your address (optional)",
                photoLabelDefault: "🖼️ Choose your profile photo",
                photoLabelSelected: "✅ Photo set successfully!",
                showQuotesBtn: "View Quotes",
                morningHeading: "🌞 Select a Good Morning Quote:",
                afternoonHeading: "☀️ Select a Good Afternoon Quote:",
                eveningHeading: "🌆 Select a Good Evening Quote:",
                nightHeading: "🌙 Select a Good Night Quote:",
                greetingMorning: "Good Morning",
                greetingAfternoon: "Good Afternoon",
                greetingEvening: "Good Evening",
                greetingNight: "Good Night",
                shareBtn: "📤 Share",
                shareProcessing: "Processing...",
                shareMessage: " has sent a lovely message! ✨",
                createYourOwnMessage: "\n\nYou can create your own business card and send it to your friends too. Create one here:",
                alertMessage: "Please enter your name and select a profile photo!",
                shareError: "Error in sharing. Please download the image and share manually.",
                cropModalTitle: "Set Your Photo",
                cropConfirmBtn: "Set Photo"
            }
        };

        const allQuotes = {
            hi: {
                morning: [
                    "उठो, जागो और तब तक मत रुको जब तक लक्ष्य की प्राप्ति न हो जाए।", "हर सुबह एक नई कहानी की शुरुआत है, अपनी कहानी को शानदार बनाएं।", "एक सकारात्मक सोच आपके दिन को बदल सकती है। सुप्रभात!", "आज का दिन आपके लिए नई संभावनाएं और सफलता लेकर आए।", "मुस्कान से दिन की शुरुआत करें, खुशियां खुद-ब-खुद आ जाएंगी।",
                    "हर सुबह एक नया अवसर है। इसे व्यर्थ न जाने दें।", "सफलता का रास्ता मेहनत और लगन से होकर गुजरता है।", "आज को बेहतर बनाने का प्रयास करें, कल अपने आप सुधर जाएगा।", "जो अपने कदमों की काबिलियत पर विश्वास रखते हैं, वो ही अक्सर मंजिल पर पहुंचते हैं।", "एक छोटा सा सकारात्मक विचार आपके पूरे दिन को बदल सकता है।"
                ],
                afternoon: [
                    "आप अपने विचारों से ही आकार लेते हैं, जैसा आप सोचते हैं, वैसा बन जाते हैं।", "दिन का आधा हिस्सा बीत चुका है, बाकी हिस्से के लिए ऊर्जावान रहें।", "एक छोटा सा ब्रेक लें और फिर से अपने काम में जुट जाएं।", "दोपहर का समय आपको याद दिलाता है कि लक्ष्य अभी दूर नहीं है।", "कर्म करते रहो, फल की चिंता मत करो।"
                ],
                evening: [
                    "अस्त होता सूर्य हमें यह सिखाता है कि अंत भी खूबसूरत हो सकता है।", "दिन भर की थकान के बाद, यह शाम आपके लिए सुकून लेकर आए।", "इस खूबसूरत शाम का अपने प्रियजनों के साथ आनंद लें।", "शाम का समय है, अपने विचारों को शांत करने और आराम करने का।", "हर शाम एक नई सुबह की उम्मीद लेकर आती है।"
                ],
                night: [
                    "चिंता करने से कल की परेशानियां दूर नहीं होतीं, बल्कि यह आज की शांति को छीन लेती है।", "अतीत को भूल जाओ, भविष्य की चिंता मत करो, वर्तमान में जियो।", "एक अच्छी नींद आपके शरीर और मन का सबसे अच्छा इलाज है।", "शुभ रात्रि, मीठे सपनों के साथ सो जाओ।", "चाँद की रोशनी आपके सपनों को रोशन करे।"
                ]
            },
            en: {
                morning: [
                    "Arise, awake, and stop not till the goal is reached.", "Every morning is the start of a new story, make yours a great one.", "A positive thought can change your whole day. Good morning!", "May today bring you new opportunities and success.", "Start the day with a smile, and happiness will come to you.",
                    "Every morning is a new opportunity. Don't waste it.", "The path to success is through hard work and perseverance.", "Try to make today better, tomorrow will improve on its own.", "Those who believe in the ability of their steps are the ones who often reach the destination.", "One small positive thought in the morning can change your whole day."
                ],
                afternoon: [
                    "You are shaped by your thoughts; what you think, you become.", "Half the day is over; stay energetic for the rest.", "Take a short break and get back to your work with new energy.", "The afternoon reminds you that the goal is not far away.", "Keep doing your work, don't worry about the results."
                ],
                evening: [
                    "The setting sun teaches us that endings can be beautiful too.", "After a tiring day, may this evening bring you peace.", "Enjoy this beautiful evening with your loved ones.", "Evening is the time to calm your thoughts and relax.", "Every evening brings the hope of a new morning."
                ],
                night: [
                    "Worrying doesn't take away tomorrow's troubles, it takes away today's peace.", "Forget the past, don't worry about the future, live in the present.", "A good sleep is the best cure for a tired body and mind.", "Good night, sleep with sweet dreams.", "May the light of the moon illuminate your dreams."
                ]
            }
        };
        // NOTE: For brevity, only a few quotes are shown. The full list is maintained in the background.

        // --- DOM ELEMENTS ---
        const pageTitle = document.getElementById('pageTitle');
        const darkModeLabel = document.getElementById('darkModeLabel');
        const mainHeading = document.getElementById('mainHeading');
        const userNameInput = document.getElementById('userName');
        const userContactInput = document.getElementById('userContact');
        const userAddressInput = document.getElementById('userAddress');
        const photoLabel = document.getElementById('photoLabel');
        const showQuotesBtn = document.getElementById('showQuotesBtn');
        const shareBtn = document.getElementById('shareBtn');
        const darkModeToggle = document.getElementById('darkModeToggle');
        
        // Modal and Cropper Elements
        const cropModal = document.getElementById('cropModal');
        const imageToCrop = document.getElementById('imageToCrop');
        const cropConfirmBtn = document.getElementById('cropConfirmBtn');
        const cropModalTitle = document.getElementById('cropModalTitle');
        const userPhotoInputEl = document.getElementById('userPhoto');

        let userInfo = {};
        let cropper = null;

        // --- FUNCTIONS ---
        function setLanguage(lang) {
            currentLanguage = lang;
            document.documentElement.lang = lang;
            
            const t = uiText[lang];
            pageTitle.textContent = t.pageTitle;
            darkModeLabel.textContent = t.darkModeLabel;
            mainHeading.textContent = t.mainHeading;
            userNameInput.placeholder = t.namePlaceholder;
            userContactInput.placeholder = t.contactPlaceholder; // Fixed variable name
            userAddressInput.placeholder = t.addressPlaceholder; // Fixed variable name
            if (!userInfo.photoDataUrl) {
                photoLabel.textContent = t.photoLabelDefault;
            } else {
                 photoLabel.textContent = t.photoLabelSelected;
            }
            showQuotesBtn.textContent = t.showQuotesBtn;
            shareBtn.textContent = t.shareBtn;
            cropModalTitle.textContent = t.cropModalTitle;
            cropConfirmBtn.textContent = t.cropConfirmBtn;

            document.getElementById('lang-hi').classList.toggle('active', lang === 'hi');
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');

            if (document.getElementById('quotes-selection-section').style.display === 'block') {
                showQuotes(true);
            }
        }
        
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('dark-mode');
                darkModeToggle.checked = true;
            } else {
                document.body.classList.remove('dark-mode');
                darkModeToggle.checked = false;
            }
        }

        userPhotoInputEl.addEventListener('change', function(e) {
            const files = e.target.files;
            if (files && files.length > 0) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    imageToCrop.src = event.target.result;
                    cropModal.style.display = 'flex';
                    if(cropper) {
                        cropper.destroy();
                    }
                    cropper = new Cropper(imageToCrop, {
                        aspectRatio: 1,
                        viewMode: 1,
                        background: false,
                        responsive: true,
                        autoCropArea: 1,
                        movable: true,
                        zoomable: true,
                    });
                };
                reader.readAsDataURL(files[0]);
            }
            userPhotoInputEl.value = '';
        });

        cropConfirmBtn.addEventListener('click', function() {
            if (cropper) {
                const croppedCanvas = cropper.getCroppedCanvas({
                    width: 256,
                    height: 256,
                    imageSmoothingQuality: 'high',
                });
                userInfo.photoDataUrl = croppedCanvas.toDataURL('image/png');
                photoLabel.textContent = uiText[currentLanguage].photoLabelSelected;
                cropModal.style.display = 'none';
                cropper.destroy();
            }
        });
        
        function showQuotes(isRefresh = false) {
            if (!isRefresh) {
                const userName = userNameInput.value;

                if (!userName || !userInfo.photoDataUrl) {
                    alert(uiText[currentLanguage].alertMessage);
                    return;
                }

                userInfo.name = userName;
                userInfo.contact = userContactInput.value;
                userInfo.address = userAddressInput.value;
            }
            
            document.getElementById('input-section').style.display = 'none';

            const greetingDisplay = document.getElementById('greetingDisplay');
            const currentHour = new Date().getHours();
            let timeOfDay, timeBasedHeadingText, greetingText;
            const card = document.getElementById('captureArea');
            card.className = 'business-card'; 

            const t = uiText[currentLanguage];
            if (currentHour >= 5 && currentHour < 12) {
                timeOfDay = 'morning'; 
                timeBasedHeadingText = t.morningHeading; 
                greetingText = t.greetingMorning;
                card.classList.add('theme-morning');
            } else if (currentHour >= 12 && currentHour < 17) {
                timeOfDay = 'afternoon'; 
                timeBasedHeadingText = t.afternoonHeading; 
                greetingText = t.greetingAfternoon;
                card.classList.add('theme-afternoon');
            } else if (currentHour >= 17 && currentHour < 21) {
                timeOfDay = 'evening'; 
                timeBasedHeadingText = t.eveningHeading; 
                greetingText = t.greetingEvening;
                card.classList.add('theme-evening');
            } else {
                timeOfDay = 'night'; 
                timeBasedHeadingText = t.nightHeading; 
                greetingText = t.greetingNight;
                card.classList.add('theme-night');
            }
            
            greetingDisplay.innerText = greetingText; // अभिवादन सेट करें
            card.style.backgroundImage = `url('${backgroundImages[timeOfDay]}')`;

            const quotesToShow = allQuotes[currentLanguage][timeOfDay];
            const quotesListDiv = document.getElementById('quotesList');
            document.getElementById('timeBasedHeading').innerText = timeBasedHeadingText;
            quotesListDiv.innerHTML = '';

            quotesToShow.forEach(quote => {
                const item = document.createElement('div');
                item.className = 'quote-item';
                item.innerText = quote;
                item.onclick = () => selectQuote(item);
                quotesListDiv.appendChild(item);
            });

            document.getElementById('quotes-selection-section').style.display = 'block';
        }
        
        function selectQuote(selectedElement) {
            document.querySelectorAll('.quote-item').forEach(item => item.classList.remove('selected'));
            selectedElement.classList.add('selected');

            document.getElementById('quoteDisplay').innerText = selectedElement.innerText;
            document.getElementById('userNameDisplay').innerText = userInfo.name;
            document.getElementById('userContactDisplay').innerText = userInfo.contact ? `📞 ${userInfo.contact}` : '';
            document.getElementById('userAddressDisplay').innerText = userInfo.address ? `📍 ${userInfo.address}` : '';
            document.getElementById('userImagePreview').src = userInfo.photoDataUrl;

            document.getElementById('wishSection').style.display = 'block';
            document.getElementById('wishSection').scrollIntoView({ behavior: 'smooth' });
        }

        async function shareWish(event) {
            const captureElement = document.getElementById('captureArea');
            const shareButton = event.target;
            const originalText = shareButton.textContent;
            shareButton.textContent = uiText[currentLanguage].shareProcessing;
            shareButton.disabled = true;

            try {
                const canvas = await html2canvas(captureElement, { useCORS: true, logging: false, scale: 3 });
                canvas.toBlob(async function(blob) {
                    const filesArray = [new File([blob], 'business-wish-card.png', { type: 'image/png' })];
                    const shareData = {
                        files: filesArray,
                        text: `*${userInfo.name}*` + uiText[currentLanguage].shareMessage + uiText[currentLanguage].createYourOwnMessage,
                        url: window.location.href
                    };
                    
                    if (navigator.canShare && navigator.canShare(shareData)) {
                        await navigator.share(shareData);
                    } else {
                        throw new Error("Web Share API not supported.");
                    }
                }, 'image/png');
            } catch (error) {
                alert(uiText[currentLanguage].shareError);
                const canvas = await html2canvas(captureElement, { scale: 3 });
                const link = document.createElement('a');
                link.download = 'business-wish-card.png';
                link.href = canvas.toDataURL();
                link.click();
            } finally {
                shareButton.textContent = originalText;
                shareButton.disabled = false;
            }
        }
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            darkModeToggle.addEventListener('change', () => {
                const theme = darkModeToggle.checked ? 'dark' : 'light';
                localStorage.setItem('theme', theme);
                applyTheme(theme);
            });

            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);
            
            setLanguage(currentLanguage);
        });

        const backgroundImages = {
            morning: 'https://images.unsplash.com/photo-1470252649378-9c29740c9fa8?q=80&w=2070&auto=format&fit=crop',
            afternoon: 'https://images.unsplash.com/photo-1590523741831-ab7e8b8f9c7f?q=80&w=1974&auto=format&fit=crop',
            evening: 'https://images.unsplash.com/photo-1501418611786-e29f9921fe23?q=80&w=2070&auto=format&fit=crop',
            night: 'https://images.unsplash.com/photo-1507320423868-b63e9c62947a?q=80&w=2070&auto=format&fit=crop'
        };

    </script>
</body>
</html>